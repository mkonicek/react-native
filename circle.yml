general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore
machine:
  xcode:
    version: 8.2.1
  node:
    version: 6.2.0
  environment:
    TERM: "dumb"

dependencies:
  override:
    - echo "//registry.npmjs.org/:_authToken=${CIRCLE_NPM_TOKEN}" > ~/.npmrc
    - npm config set spin=false
    - npm config set progress=false
    - npm install
    # for eslint bot
    - npm install github@0.2.4
    - cd website && npm install
  cache_directories:
    - "website/node_modules"
    - "node_modules"

test:
  override:
    - ./scripts/objc-test-ios.sh

    # JS tests for dependencies installed with npm3
    - npm run flow -- check
    - npm test -- --maxWorkers=1

    
  post:
    # copy test report for Circle CI to display
    - mkdir -p $CIRCLE_TEST_REPORTS/junit/
    - find . -type f -regex ".*/build/test-results/debug/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;
    - find . -type f -regex ".*/outputs/androidTest-results/connected/.*xml" -exec cp {} $CIRCLE_TEST_REPORTS/junit/ \;

experimental:
  notify:
    branches:
      only:
        - master
        - /.*-stable/
